# 빅히스토리 AI: 주제 선정 및 강의 자료 생성 프로세스

이 문서는 사용자가 채팅창에 "주제(Topic)"를 입력했을 때, 빅히스토리 플랫폼이 어떻게 내부 데이터를 검색하고 **단원 목표**와 **핵심 질문**을 선정하여 강의 자료를 생성하는지 그 기술적/논리적 과정을 설명합니다.

## 1. 전체 프로세스 개요 (Overview)

강의 자료 생성은 크게 **검색(Retrieval)**, **컨텍스트 구성(Context Building)**, **생성(Generation)**의 3단계로 이루어집니다.

1.  **사용자 입력**: 사용자가 주제(예: "빅뱅", "DNA")를 입력.
2.  **지식 검색 (RAG)**: Google Vertex AI Search가 전체 PDF 데이터(20권 분량)에서 관련 내용을 검색.
3.  **답변 생성 (LLM)**: 검색된 데이터를 바탕으로, 사전에 정의된 **프롬프트 규칙**에 따라 강의 자료를 작성.

---

## 2. 단계별 상세 로직

### 2.1 검색 단계 (Retrieval)
사용자가 입력한 "주제"를 키워드로 하여 데이터스토어(Data Store)를 검색합니다. 이때 특정 파일만 검색하는 것이 아니라, 업로드된 4가지 유형의 모든 파일을 대상으로 관련성 높은 "조각(Snippet)"을 찾아냅니다.

*   **대상 파일 유형**:
    1.  `*-Content`: 목차 및 흐름
    2.  `*-Main`: 본문 (상세 내용)
    3.  `*-Summary`: **요약 (주로 단원 목표 및 핵심 질문 추출용)**
    4.  `*-ReferenceBooks`: 참고 자료

### 2.2 프롬프트 엔지니어링 (Prompt Logic)
검색된 데이터 조각들이 LLM(AI 모델)에게 전달될 때, **`src/lib/prompts.ts`**에 정의된 시스템 프롬프트가 이 데이터를 어떻게 해석하고 활용해야 할지 지시합니다.

**핵심 로직 (단원 목표 및 핵심 질문 추출 기준):**

프롬프트는 AI에게 다음과 같이 파일 유형별 역할을 명시적으로 부여합니다.

> **[데이터 구조 해석 가이드]**
> *   **Summary**: 단원 목표 정리 및 작가 의도 파악 시 참고
> *   **Main**: 본문 개념 설명 및 사실 확인

즉, AI는 검색된 결과 중 파일명이 `Summary`로 끝나거나 내용이 요약적인 텍스트를 우선적으로 분석하여 **단원 목표**와 **핵심 질문**을 구성합니다.

### 2.3 생성 단계 (Generation)

AI는 위 지침에 따라 다음과 같이 내용을 구성하여 출력합니다.

1.  **단원 목표 선정**:
    *   검색 결과 중 `Summary` 데이터에서 해당 주제가 다루는 학습 목표를 식별하여 "1. 단원 목표" 섹션에 작성합니다.
    *   예: "우주의 탄생 과정을 이해하고..."

2.  **핵심 질문 선정**:
    *   주제와 관련된 본문(`Main`) 및 요약(`Summary`) 내용 중 가장 탐구 가치가 높은 질문을 추출합니다.
    *   질문에 대한 해설은 본문(`Main`)의 상세 내용을 바탕으로 작성됩니다.

---

## 3. 요약 (Summary)

| 생성 항목 | 주요 참조 데이터 소스 | 선정 로직 (Algorithm) |
| :--- | :--- | :--- |
| **단원 목표** | `*-Summary.pdf` | 검색된 컨텍스트 중 `Summary` 유형의 텍스트를 우선 분석하여 요약 및 재구성 |
| **핵심 질문** | `*-Main.pdf`, `*-Summary.pdf` | 주제와 관련된 핵심 쟁점을 파악하고, 본문 내용을 근거로 심화 질문 생성 |
| **학습 흐름** | `*-Content.pdf`, `*-Main.pdf` | 목차(`Content`)의 구조를 참고하여 수업 진행 순서 구성 |

결론적으로, 특정 DB 필드를 쿼리하는 것이 아니라, **관련성 높은 문서를 광범위하게 검색한 후, 프롬프트 규칙에 따라 AI가 문서의 용도(Summary vs Main)를 구분하여 적절한 내용을 추출/생성**하는 방식입니다.
