# PDF 멀티모달 데이터(표, 그래프, 이미지) 추출 및 활용 방안 연구

## 1. 개요
현재 시스템은 텍스트 중심의 데이터만 활용하고 있으나, 원본 PDF에는 풍부한 시각 자료(표, 그래프, 삽화 등)가 포함되어 있습니다. 이를 추출하여 BigHistory AI 서비스(채팅 답변, 강의 노트)에 활용하기 위한 기술적 방안을 정리합니다.

## 2. Google Cloud 기반 솔루션 (Google Cloud Recommendation)

사용자의 요청에 따라 Google Cloud Platform (GCP) 내에서 가장 적합한 도구를 우선적으로 추천합니다.

### A. Vertex AI Gemini 1.5 Pro (Multimodal) - **추천**
현재 프로젝트에서 이미 사용 중인 Vertex AI를 적극 활용하는 방안입니다. Gemini 1.5 모델은 **멀티모달(Multimodal)** 능력이 뛰어나 PDF 자체를 이해할 수 있습니다.

*   **기능**:
    *   PDF의 페이지를 이미지로 변환하여 모델에 입력하면, 그 안에 있는 **도표나 그래프의 의미를 해석**할 수 있습니다. (예: "이 그래프의 수치를 CSV로 뽑아줘", "이 삽화가 의미하는 바를 설명해줘")
    *   단순한 "이미지 파일 추출"을 넘어, **"이미지의 맥락 이해"**에 가장 강력합니다.
*   **한계**:
    *   이미지 파일 자체를 원본 화질로 "잘라내서(Crop)" 저장해주는 기능은 아닙니다. (분석용 도구)
    *   따라서 **이미지 파일 추출(수집)은 별도 라이브러리**가 필요합니다.

### B. Google Cloud Document AI (DocAI)
구글의 문서 처리 전문 솔루션입니다.
*   **기능**:
    *   **Form Parser / Layout Parser**: 문서의 구조를 분석하여 **표(Table)** 데이터를 구조화된 형태(JSON)로 정확하게 추출하는 데 특화되어 있습니다.
    *   이미지 영역을 감지하고 좌표(Bbox)를 제공할 수 있습니다.
*   **장점**: 표 데이터 추출 정확도가 매우 높습니다.
*   **단점**: 비용이 발생하며, 단순 삽화 추출보다는 "문서 서식 처리"에 더 초점이 맞춰져 있습니다.

---

## 3. 실질적 구현 방안 (Python Library + GCP Hybrid)

가장 비용 효율적이고 실용적인 방법은 **오픈소그 라이브러리로 "추출"하고, GCP Gemini로 "분석/분류"하는 하이브리드 방식**입니다.

### 단계별 프로세스 (Pipeline)

1.  **이미지/표 추출 (Extraction)**: Python 라이브러리 사용
    *   **PyMuPDF (fitz)**: PDF 내의 **이미지(삽화, 사진)**를 원본 화질 그대로 추출하는 데 가장 빠르고 강력합니다.
    *   **pdfplumber**: PDF 내의 **표(Table)** 영역을 감지하고 텍스트/CSV로 변환하는 데 유용합니다.
    *   **Camelot**: 표 추출의 또 다른 강력한 대안입니다.

2.  **분석 및 메타데이터 생성 (Understanding)**: **Vertex AI Gemini** 사용
    *   추출된 이미지를 Gemini에게 전송하여 **"이 이미지가 무엇인지(그래프, 단순 장식, 중요 삽화 등)" 분류**하고 설명을 생성하게 합니다.
    *   표 이미지를 텍스트 데이터(Markdown/JSON)로 변환 요청하여 검색 가능하게 만듭니다.

3.  **저장 (Storage)**: **Supabase Storage** 또는 **Google Cloud Storage**
    *   추출된 이미지 파일을 클라우드 스토리지에 저장하고, 해당 URL을 문서 텍스트(Chunk)와 매핑하여 DB에 저장합니다.

4.  **활용 (Serving)**
    *   사용자가 관련 질문을 했을 때, RAG 검색 결과와 함께 **해당 이미지의 URL을 함께 제공**하여 채팅창에 띄워줍니다.

## 4. 결론 및 추천
**"Google Cloud Vertex AI (Gemini)"와 "PyMuPDF"를 결합하는 방식**을 추천합니다.

*   **이미지/일러스트**: `PyMuPDF`로 추출 -> `Google Cloud Storage` 저장 -> 채팅 시 보여줌.
*   **표/그래프 데이터**: `Gemini`에게 이미지를 보여주고 데이터(JSON/Markdown)로 변환해달라고 요청 -> 텍스트로 저장하여 답변에 활용.

이 방식은 추가적인 값비싼 SaaS 비용 없이, 현재 사용 중인 기술 스택 내에서 구현 가능합니다.
